<script>
function success(position) {
  $("#results").load(document.URL + "?latitude=" + position.coords.latitude + "&longitude=" + position.coords.longitude);
}

function error(msg) {

}

$('document').ready(function() {
  if (!$('#location').val() && window.location.search.indexOf('location') == -1) {
    if(navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(success,error);
    }
  }
});
</script>
<div id="results">
  <%= form_tag things_path, :method => :get, :class => 'search' do %>
    <%= label_tag :what, "find" %>
    <%= text_field_tag :what, params[:what], :placeholder => 'Any stuff' %>
    <%= label_tag :location, "near" %>
    <%= text_field_tag :location, @location %>
    <input type="submit" value="Search" class="btn primary">
  <% end %>

  <ol class="stuff-list">
    <% @things.each do |thing| %>
      <li>
      <a href="<%= thing_path thing %>" title="<%= thing.description %>">
        <%= image_tag thing.image_url(:thumb).to_s %>
        <strong><%= thing.title %></strong>
        <span><%= thing.address %></span>
        <%= "#{time_ago_in_words(thing.created_at)} ago" %>
      </a>
    </li>
  <% end %>
  </ol>

</div>

